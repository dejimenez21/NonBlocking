<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <button name="Boton" id="sync">Sync</button>
    <button name="Boton" id="async">Async</button>


    <div class="clearfix"></div>

    <script>


        asyncbtn = document.getElementById("async");

        syncbtn = document.getElementById("sync");

        asyncbtn.addEventListener("click", () => {
            var xhttp = new XMLHttpRequest();


            xhttp.open("GET", "https://localhost:5001/api/images", true);
            xhttp.withCredentials = true;

            xhttp.send();
            //console.log("llegue");
            xhttp.onload = async function () {
                if (xhttp.readyState === xhttp.DONE) {
                    if (xhttp.status === 200) {
                        var json = JSON.parse(xhttp.responseText);

                        for (let index = 0; index < json.length; index++) {
                                        let div = document.createElement("img");
                                        let att = document.createAttribute("class");       // Create a "class" attribute
                                        att.value = "img";                           // Set the value of the class attribute
                                        div.setAttributeNode(att);
                                        let body = document.getElementsByTagName('body')[0];
                                        body.appendChild(div);
                                        var imgs = document.getElementsByClassName("img");
                            
                        }

                        console.log(imgs);



                        for (let index = 1; index <= json.length; index++) {

                            xhttp.open("GET", "https://localhost:5001/api/images/" + index, true);
                            xhttp.withCredentials = true;

                            xhttp.send();
                            //console.log("llegue");
                            xhttp.onload = await function () {
                                if (xhttp.readyState === xhttp.DONE) {
                                    if (xhttp.status === 200) {
                                        let jsonObject = JSON.parse(xhttp.responseText);


                                        

                                        console.log(jsonObject);

                                        //for (let index = 0; index < imgs.length; index++) {
                                           
                                            console.log(jsonObject);
                                            imgs[index].setAttribute("src",
                                                "data:" + jsonObject.mimeType + ";base64," + jsonObject.base64);
                                            console.log(index);

                                        //}
                                    }
                                }
                            };


                        }
                    }
                }
            };
        })

        syncbtn.addEventListener("click", () => {
            var xhttp = new XMLHttpRequest();




            xhttp.open("GET", "https://localhost:5001/api/images", true);
        xhttp.withCredentials = true;

        xhttp.send();
            //console.log("llegue");
        xhttp.onload = function () {
            if (xhttp.readyState === xhttp.DONE) {
                if (xhttp.status === 200) {
                    var json = JSON.parse(xhttp.responseText);

                    for (let index = 0; index < json.length; index++) {
                        var div = document.createElement("img");
                        var att = document.createAttribute("class");       // Create a "class" attribute
                        att.value = "img";                           // Set the value of the class attribute
                        div.setAttributeNode(att);

                var body = document.getElementsByTagName('body')[0];
                body.appendChild(div);
                        
                    }

                }
            }
        }});


    </script>
    <style>
        .img {
            height: 175px;
            width: 15%;
            margin: 15px;
            padding: 0px;
            border: 2px solid black;

            float: left;
        }

        .clearfix {
            clear: both;
            display: block;
        }

        .img {
            height: 175px;
            width: 15%;
        }

        #sync {
            margin: 10px;
            float: left;
        }

        #async {
            margin: 10px;
            float: left;
        }
    </style>
</body>

</html>